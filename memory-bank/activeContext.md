# Active Context: tsubame-ci

## 現在の状態

**プロジェクトフェーズ**: Phase 2 - コア機能実装（ほぼ完了）
**最終更新**: 2025-12-03
**最新コミット**: a05aaef - フロントエンドビュー追加完了

## 現在の作業フォーカス

### Phase 2 コア機能実装 ✅
バックエンドとフロントエンドの基本機能が実装され、MVPレベルに到達しています。

### 実装完了した機能
- ✅ バックエンドAPIの完全実装
- ✅ フロントエンドUIの基本実装
- ✅ Docker環境の構築
- ✅ データベーススキーマの実装

## 次のステップ

### 短期的な目標（今後1-2セッション）

#### 1. 統合テストと動作確認
**優先度**: 🔴 最高
- [ ] Docker Composeでの完全な起動確認
- [ ] フロントエンドとバックエンドの統合テスト
- [ ] SSH接続とジョブ実行の実際のテスト
- [ ] エラーハンドリングの検証

#### 2. WebSocketによるリアルタイムログストリーミング
**優先度**: 🔴 最高
- [ ] バックエンドのWebSocketエンドポイント実装
- [ ] フロントエンドのWebSocket接続実装
- [ ] リアルタイムログ表示コンポーネントの改善

#### 3. UI/UX改善
**優先度**: 🟡 高
- [ ] エラーメッセージの表示改善
- [ ] ローディング状態の改善
- [ ] フォームバリデーションの強化
- [ ] レスポンシブデザインの最適化

### 中期的な目標（Phase 3）

#### 1. 認証・認可機能
- [ ] JWT認証の実装
- [ ] ログイン/ログアウト機能
- [ ] ユーザー管理画面
- [ ] ロールベースアクセス制御

#### 2. スケジュール実行機能
- [ ] Cron式によるスケジュール定義
- [ ] スケジューラーの実装（APScheduler等）
- [ ] スケジュール管理UI

#### 3. 通知機能
- [ ] 実行完了時の通知設定
- [ ] メール通知
- [ ] Slack/Webhook通知

#### 4. 高度な機能
- [ ] ジョブの依存関係管理
- [ ] 環境変数の管理
- [ ] 複数サーバへの並列実行
- [ ] 実行統計ダッシュボード

## アクティブな決定事項と検討中の事項

### 確定している決定

1. **技術スタック** ✅
   - Vue3 + TypeScript + Vuetify3（フロントエンド）
   - FastAPI + PostgreSQL（バックエンド）
   - Docker Compose（デプロイ）

2. **アーキテクチャパターン** ✅
   - 3層アーキテクチャ（Presentation / Business / Data Access）
   - RESTful API + WebSocket（予定）
   - Pinia for 状態管理

3. **開発方針** ✅
   - 日本語コメント・コミットメッセージ
   - 型安全性重視（TypeScript strict mode, Python type hints）
   - クリーンアーキテクチャ

4. **セキュリティ** ✅
   - SSH認証情報のFernet暗号化
   - 環境変数での暗号化キー管理

### 検討中・未決定の事項

#### 1. 認証・認可の実装方法
**現状**: Phase 3で実装予定
**選択肢**:
- JWT認証（最有力）
- セッションベース認証
- OAuth2対応（将来的）

**次のアクション**: Phase 3でJWTベースの認証を実装

#### 2. WebSocketの実装詳細
**現状**: バックエンドの実装が必要
**検討事項**:
- リアルタイムログのストリーミング方式
- 接続の管理方法
- エラーハンドリング
- 再接続ロジック

**次のアクション**: バックエンドのWebSocketエンドポイント実装

#### 3. 長時間実行ジョブの処理
**現状**: 基本的な非同期実行は実装済み
**検討事項**:
- タイムアウト設定のカスタマイズ
- 実行中ジョブのキャンセル機能
- 複数ジョブの同時実行数制限
- ジョブキューの導入（Celery等）

**次のアクション**: 実際の運用を通じて必要な機能を追加

#### 4. ログの保存戦略
**現状**: PostgreSQLのTEXT型で保存
**検討事項**:
- 大量ログのパーティショニング
- ログのアーカイブ/削除ポリシー
- ログの圧縮保存
- 外部ログストレージの利用（S3等）

**次のアクション**: Phase 4で最適化を検討

## 最近の変更

### 2025-12-03: Phase 2 完了
- ✅ バックエンドの完全実装
  - FastAPI + PostgreSQL
  - サーバ/ジョブ/実行履歴の CRUD API
  - SSH接続とスクリプト実行機能
  - 認証情報の暗号化
- ✅ フロントエンドの基本実装
  - Vue3 + TypeScript + Vuetify3
  - ダッシュボード画面
  - サーバ管理画面
  - ジョブ管理画面
  - 実行履歴画面
  - 実行詳細画面
  - Pinia ストア実装
- ✅ Docker環境の構築
  - docker-compose.yml
  - Dockerfile（バックエンド/フロントエンド）

### 以前の変更
- 2025-12-03（初期）: Memory Bank初期化完了

## 注意事項・メモ

### 開発時の注意点

1. **SSH接続のセキュリティ**
   - ✅ 認証情報の暗号化は実装済み
   - [ ] known_hostsの検証を実装する必要あり
   - [ ] SSH接続のタイムアウト設定を調整
   - [ ] 接続プールの検討（将来的）

2. **データベース設計**
   - ✅ 基本的なスキーマは実装済み
   - [ ] 実行ログが大量になる場合のパーティショニング検討
   - [ ] インデックスの最適化（実運用後）

3. **エラーハンドリング**
   - ✅ 基本的なエラーハンドリングは実装済み
   - [ ] ユーザーフレンドリーなエラーメッセージの改善
   - [ ] フロントエンドでのエラー通知の改善
   - [ ] リトライロジックの実装（必要に応じて）

4. **UI/UX**
   - ✅ 基本的な画面は実装済み
   - [ ] 長時間実行ジョブの進捗表示の改善
   - [ ] WebSocketによるリアルタイム更新の実装
   - [ ] レスポンシブデザインの最適化
   - [ ] アクセシビリティの改善

5. **パフォーマンス**
   - [ ] フロントエンドのビルド最適化
   - [ ] APIレスポンスのキャッシング
   - [ ] データベースクエリの最適化
   - [ ] ログ表示のページネーション改善

## 参照すべき外部リソース

### ドキュメント
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Vue3公式ドキュメント](https://vuejs.org/)
- [Vuetify3ドキュメント](https://vuetifyjs.com/)
- [asyncssh Documentation](https://asyncssh.readthedocs.io/)
- [SQLAlchemy 2.0 Documentation](https://docs.sqlalchemy.org/)

### 参考プロジェクト
- Jenkins UI: 既存CI/CDツールのUX参考
- GitLab CI/CD: パイプライン表示の参考
- GitHub Actions: ログ表示の参考

## ブロッカー・依存関係

### 現在のブロッカー
なし（基本機能は実装済み）

### 次のステップの依存関係
- WebSocket実装は、バックエンドの実装が完了次第、フロントエンドで統合可能
- 認証機能は独立して実装可能
- スケジュール機能は、基本的なジョブ実行機能が安定してから実装推奨

## 今後の拡張アイデア

### Phase 3で実装予定の機能
1. **認証・認可**
   - JWT認証
   - ユーザー管理
   - ロールベースアクセス制御

2. **WebSocketによるリアルタイム更新**
   - 実行ログのストリーミング
   - ダッシュボードのリアルタイム更新

3. **スケジュール実行**
   - Cron式による定期実行
   - スケジュール管理UI

4. **通知機能**
   - メール通知
   - Slack/Webhook通知

### Phase 4以降で検討する機能
1. **高度な機能**
   - ジョブの依存関係管理
   - パイプライン機能
   - 複数サーバへの並列実行
   - 環境変数の管理
   - 実行統計・レポート

2. **技術的な改善**
   - パフォーマンス最適化
   - ログストリーミングの効率化
   - キャッシング戦略
   - 監視・アラート機能
   - テストカバレッジの向上

3. **運用機能**
   - バックアップ・リストア
   - ログのアーカイブ
   - データのエクスポート/インポート
   - 監査ログ

## コンテキスト継続性のためのキーポイント

次回セッション開始時に確認すべきこと：
1. ✅ プロジェクト構造が作成済み
2. ✅ バックエンドとフロントエンドの基本実装が完了
3. 🔄 統合テストの実施状況
4. 🔄 WebSocket実装の進捗
5. 🔄 実運用で発見された課題

## 現在の開発状態まとめ

### 完成度
- **バックエンド**: 80% （WebSocket未実装）
- **フロントエンド**: 75% （WebSocket、細かいUI改善必要）
- **Docker環境**: 95% （動作確認が必要）
- **全体**: 75% （MVPレベル達成、Phase 2ほぼ完了）

### 推奨される次のアクション
1. Docker Composeで完全な動作確認を実施
2. WebSocketによるリアルタイムログストリーミングの実装
3. UI/UXの細かい改善
4. Phase 3（認証機能、スケジュール実行）への移行準備
