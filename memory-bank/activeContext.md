# Active Context: tsubame-ci

## 現在の状態

**プロジェクトフェーズ**: Phase 1 - 基盤構築（初期化完了）
**最終更新**: 2025-12-03

## 現在の作業フォーカス

### Memory Bank 初期化 ✅
Memory Bankの6つのコアファイルを作成し、プロジェクトの基盤ドキュメントを整備しました。

## 次のステップ

### 短期的な目標（今後1-2セッション）

#### 1. プロジェクト構造のセットアップ
- [ ] ディレクトリ構造の作成
  - `frontend/` ディレクトリ
  - `backend/` ディレクトリ
  - `docker-compose.yml`
  - `.gitignore`

#### 2. バックエンドの初期セットアップ
- [ ] FastAPIプロジェクトの初期化
  - `requirements.txt` 作成
  - `app/main.py` 作成
  - 基本的なディレクトリ構造の作成
  - データベース設定

#### 3. フロントエンドの初期セットアップ
- [ ] Vue3プロジェクトの初期化（Vite）
  - Vuetify3のインストールと設定
  - TypeScript設定
  - Pinia設定
  - Vue Router設定

### 中期的な目標（Phase 2）

#### コア機能の実装
1. **サーバ管理機能**
   - サーバ情報のCRUD
   - SSH接続テスト機能

2. **ジョブ管理機能**
   - ジョブ定義のCRUD
   - スクリプト編集機能

3. **実行機能**
   - SSH経由でのスクリプト実行
   - 実行ログの保存
   - リアルタイム進捗表示（WebSocket）

4. **実行履歴機能**
   - 過去の実行結果の閲覧
   - ログの検索・フィルタリング

## アクティブな決定事項と検討中の事項

### 確定している決定

1. **技術スタック**
   - ✅ Vue3 + TypeScript + Vuetify3（フロントエンド）
   - ✅ FastAPI + PostgreSQL（バックエンド）
   - ✅ Docker Compose（デプロイ）

2. **アーキテクチャパターン**
   - ✅ 3層アーキテクチャ（Presentation / Business / Data Access）
   - ✅ RESTful API + WebSocket
   - ✅ Pinia for 状態管理

3. **開発方針**
   - ✅ 日本語コメント・コミットメッセージ
   - ✅ 型安全性重視（TypeScript strict mode, Python type hints）
   - ✅ クリーンアーキテクチャ

### 検討中・未決定の事項

#### 1. 認証・認可の実装方法
**現状**: 未決定
**選択肢**:
- JWT認証
- セッションベース認証
- OAuth2対応

**次のアクション**: Phase 2で要件を明確化し、JWTベースで開始予定

#### 2. SSH認証情報の管理方法
**現状**: Fernet暗号化の方向で検討中
**懸念事項**:
- 暗号化キーの管理方法
- キーローテーション戦略

**次のアクション**: 
- 環境変数でのキー管理を実装
- 将来的にVaultなどの秘密管理ツールへの移行を検討

#### 3. 長時間実行ジョブの処理
**現状**: 非同期実行の方向
**検討事項**:
- タイムアウト設定（デフォルト値）
- 実行中ジョブのキャンセル機能
- 複数ジョブの同時実行数制限

**次のアクション**: Phase 2実装時に具体的な仕様を決定

#### 4. フロントエンドのビルド設定
**現状**: Viteを使用予定
**検討事項**:
- プロダクションビルドの最適化
- 環境変数の管理（.env）
- APIエンドポイントの設定方法

**次のアクション**: 初期セットアップ時に設定

## 最近の変更

### 2025-12-03: Memory Bank 初期化
- プロジェクトブリーフの作成
- 技術コンテキストの文書化
- システムパターンの定義
- プロダクトコンテキストの明確化

## 注意事項・メモ

### 開発時の注意点

1. **SSH接続のセキュリティ**
   - known_hostsの検証を適切に実装する
   - SSH秘密鍵のパーミッション管理
   - タイムアウト設定を忘れずに

2. **データベース設計**
   - 実行ログが大量になる可能性があるため、パーティショニングやアーカイブ戦略を考慮
   - インデックスの適切な設計

3. **エラーハンドリング**
   - SSH接続失敗時の適切なエラーメッセージ
   - ネットワークタイムアウトの処理
   - データベース接続エラーの処理

4. **UI/UX**
   - 長時間実行ジョブの進捗表示
   - エラー時のユーザーへのフィードバック
   - レスポンシブデザイン対応

## 参照すべき外部リソース

### ドキュメント
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Vue3公式ドキュメント](https://vuejs.org/)
- [Vuetify3ドキュメント](https://vuetifyjs.com/)
- [asyncssh Documentation](https://asyncssh.readthedocs.io/)

### 参考プロジェクト
- Jenkins UI: 既存CI/CDツールのUX参考
- GitLab CI/CD: パイプライン表示の参考

## ブロッカー・依存関係

### 現在のブロッカー
なし（プロジェクト初期化完了）

### 次のステップの依存関係
- プロジェクト構造のセットアップは他のすべての開発の前提条件
- バックエンドとフロントエンドは並行して開発可能
- Docker Composeの設定は両方のセットアップ後に実装

## 今後の拡張アイデア

### Phase 3以降で検討する機能
1. **スケジュール実行（Cron的な機能）**
2. **ジョブの依存関係管理**
3. **通知機能（実行完了時のメール/Slack通知）**
4. **ユーザー管理とロールベースアクセス制御**
5. **実行統計・ダッシュボード**
6. **環境変数の管理**
7. **複数サーバへの並列実行**
8. **スクリプトのバージョン管理**

### 技術的な改善アイデア
1. **パフォーマンス最適化**
   - ログストリーミングの効率化
   - データベースクエリの最適化

2. **監視・ロギング**
   - アプリケーションメトリクスの収集
   - 構造化ログの実装

3. **テスト**
   - ユニットテスト
   - 統合テスト
   - E2Eテスト

4. **CI/CD**
   - GitHub Actions / GitLab CI での自動テスト
   - 自動デプロイ

## コンテキスト継続性のためのキーポイント

次回セッション開始時に確認すべきこと：
1. プロジェクト構造が作成されているか
2. どのフェーズで作業しているか
3. 実装中の機能は何か
4. 未解決の技術的課題はあるか
